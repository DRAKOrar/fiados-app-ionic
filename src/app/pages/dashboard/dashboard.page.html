<ion-header [translucent]="true">
  <ion-toolbar style="--background: #132440; --color: white;">
    <ion-title>
      <ion-icon name="stats-chart" style="color: #3B9797;"></ion-icon>
      &nbsp;Mi Negocio
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="irABusqueda()" style="--color: white;">
        <ion-icon name="search"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="refrescar($event)">
    <ion-refresher-content
      pullingIcon="arrow-down"
      pullingText="Desliza para actualizar"
      refreshingSpinner="circles">
    </ion-refresher-content>
  </ion-refresher>

  <div class="container">

    <!-- Estadísticas principales -->
    <div class="stats-grid">
      <ion-card class="stat-card primary">
        <ion-card-content>
          <div class="stat-icon">
            <ion-icon name="cash"></ion-icon>
          </div>
          <div class="stat-info">
            <h2>{{ formatearMoneda(estadisticas.totalPorCobrar) }}</h2>
            <p>Por Cobrar</p>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stat-card success">
        <ion-card-content>
          <div class="stat-icon">
            <ion-icon name="wallet"></ion-icon>
          </div>
          <div class="stat-info">
            <h2>{{ formatearMoneda(estadisticas.totalCobrado) }}</h2>
            <p>Cobrado</p>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stat-card info">
        <ion-card-content>
          <div class="stat-icon">
            <ion-icon name="trending-up"></ion-icon>
          </div>
          <div class="stat-info">
            <h2>{{ formatearMoneda(estadisticas.totalVendido) }}</h2>
            <p>Total Vendido</p>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stat-card clients">
        <ion-card-content>
          <div class="stat-icon">
            <ion-icon name="people"></ion-icon>
          </div>
          <div class="stat-info">
            <h2>{{ estadisticas.totalClientes }}</h2>
            <p>Clientes</p>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Resumen de deudas -->
    <ion-card class="card-elevated">
      <ion-card-header class="card-header-custom">
        <ion-card-title>Resumen de Deudas</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="deudas-resumen">
          <div class="resumen-item">
            <div class="resumen-icon-container warning">
              <ion-icon name="time-outline"></ion-icon>
            </div>
            <div>
              <h3>{{ estadisticas.deudasPendientesCount }}</h3>
              <p>Pendientes</p>
            </div>
          </div>
          <div class="resumen-item">
            <div class="resumen-icon-container success">
              <ion-icon name="checkmark-circle"></ion-icon>
            </div>
            <div>
              <h3>{{ estadisticas.deudasPagadasCount }}</h3>
              <p>Pagadas</p>
            </div>
          </div>
          <div class="resumen-item">
            <div class="resumen-icon-container primary">
              <ion-icon name="cart"></ion-icon>
            </div>
            <div>
              <h3>{{ estadisticas.totalDeudas }}</h3>
              <p>Total</p>
            </div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Top clientes con deuda -->
    <ion-card class="card-elevated" *ngIf="estadisticas.clientesConDeuda.length > 0">
      <ion-card-header class="card-header-custom">
        <div class="card-header-with-action">
          <ion-card-title>Clientes con Mayor Deuda</ion-card-title>
          <ion-button fill="clear" size="small" class="btn-see-all" (click)="verClientes()">
            Ver todos
          </ion-button>
        </div>
      </ion-card-header>
      <ion-card-content>
        <ion-list class="custom-list">
          <ion-item
            *ngFor="let cliente of estadisticas.clientesConDeuda"
            button
            (click)="verCliente(cliente)"
            detail="true"
            class="custom-item">
            <div class="item-icon-container" slot="start">
              <ion-icon name="person"></ion-icon>
            </div>
            <ion-label>
              <h3>{{ cliente.nombre }}</h3>
              <p *ngIf="cliente.telefono">{{ cliente.telefono }}</p>
            </ion-label>
            <div slot="end" class="cliente-saldo">
              {{ formatearMoneda(cliente.saldoTotal) }}
            </div>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Deudas recientes -->
    <ion-card class="card-elevated" *ngIf="estadisticas.deudasRecientes.length > 0">
      <ion-card-header class="card-header-custom">
        <ion-card-title>Actividad Reciente</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <ion-list class="custom-list">
          <ion-item
            *ngFor="let deuda of estadisticas.deudasRecientes"
            button
            (click)="verDeuda(deuda)"
            detail="true"
            class="custom-item">
            <div class="item-icon-container" slot="start" [class]="deuda.estado === 'pagada' ? 'success' : 'warning'">
              <ion-icon name="cart"></ion-icon>
            </div>
            <ion-label>
              <h3>{{ deuda.clienteNombre }}</h3>
              <p>{{ formatearFecha(deuda.fecha) }} · {{ deuda.productos.length }} producto(s)</p>
            </ion-label>
            <div slot="end" class="deuda-info">
              <div class="monto">{{ formatearMoneda(deuda.total) }}</div>
              <ion-badge [class]="deuda.estado === 'pagada' ? 'badge-success' : 'badge-warning'">
                {{ deuda.estado === 'pagada' ? 'Pagada' : 'Pendiente' }}
              </ion-badge>
            </div>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>

    <!-- Mensaje si no hay datos -->
    <div *ngIf="estadisticas.totalClientes === 0" class="empty-state">
      <div class="empty-icon-container">
        <ion-icon name="person-add"></ion-icon>
      </div>
      <h2>¡Bienvenido!</h2>
      <p>Comienza agregando tu primer cliente y registrando deudas</p>
      <ion-button (click)="agregarCliente()" expand="block" class="btn-primary">
        <ion-icon name="add" slot="start"></ion-icon>
        Agregar Cliente
      </ion-button>
    </div>

  </div>

  <!-- Botón flotante -->
  <ion-fab slot="fixed" vertical="bottom" horizontal="end" *ngIf="estadisticas.totalClientes > 0">
    <ion-fab-button class="fab-primary" (click)="agregarCliente()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
